#!/bin/bash
set -e

# Build release binary
if [[ -d "/opt/zerobrew/prefix/lib/pkgconfig" ]]; then
    export PKG_CONFIG_PATH="/opt/zerobrew/prefix/lib/pkgconfig:${PKG_CONFIG_PATH:-}"
fi
if [[ -d "/opt/homebrew/lib/pkgconfig" ]] && [[ ! "$PKG_CONFIG_PATH" =~ "/opt/homebrew/lib/pkgconfig" ]]; then
    export PKG_CONFIG_PATH="/opt/homebrew/lib/pkgconfig:${PKG_CONFIG_PATH:-}"
fi

cargo build --release -p zb_cli

# Install to ~/.local/bin (create if needed)
mkdir -p ~/.local/bin
cp target/release/zb ~/.local/bin/zb

echo "Installed zb to ~/.local/bin/zb"
echo ""
echo "Make sure ~/.local/bin is in your PATH. Add this to your shell rc file if needed:"
echo '  export PATH="$HOME/.local/bin:$PATH"'
